# 无序R×C列表

# 双向无序RxC表
行×列表资料的卡方检验用于多个样本率的比较、两个或多个构成比的比较以及双向无序分类资料的关联性检验。当两个分类变量均为无序分类变量时，即称为**双向无序R×C表资料**，医学研究中，研究者常需要研究两个分类变量之间的关系及其关系强度。
+ RxC表卡方检验
+ RxC表Fisher确切概率法

```
RxC表卡方检验的注意事项
1、一般认为，RxC表中各格子的理论频数不应小于1，并且1<=T<5的格子数不宜超过格子总数的1/5。若出现这种情况，可通过以下方法解决：增加样本含量，使理论频数增大；根据专业知识，考虑删去或合并理论频数太小的行或列；改用RxC表的Fisher确切概率法

2、多个样本率比较，若统计推断结果拒绝H0，接受H1时，只说明各总体率之间总的来说有别，但并不能说明任两个总体率之间均有差别。要进一步推断，需做多个样本率的多重比较。

3、RxC表的卡方检验与分类结果的排序无关。对于有序RxC表，如果分析的目的不是对构成比进行比较，例如比较两组的疗效，试验结果为“痊愈、显效、有效、无效”，则不宜使用卡方检验，对此可以选用非参数秩和检验方法

```
## 一、基本原理
```
H0：两个变量间无关联；
H1：两个变量间有关联。
α=0.05
```
```
当P值＜0.05时，拒绝 H0，接受H1，认为两个变量间有关联。
====>
在确认两变量间有关联的前提下，若须进一步分析关系的密切程度时，可计算Pearson列联表系数C为行×列表资料的值，n为样本含量。C的取值在0~1之间，0表示完全独立；1表示完全相关；越接近1，表示关系越密切。
```

## 二、适用条件

①一般而言，行×列表资料中任一格子的频数不应小于1，且1≤T＜5的格子数不宜超过格子总数的25%。

②行×列表资料中的两个分类变量均为无序变量。


## Pearson's chi squared test
卡方分析用于比较不同组之间的构成比，它的零假设是假定各组之间的构成是相同的，计算出理论每组的理论构成比，再计算理论值与实际值的差别，如果差别大的话，就拒绝零假设。它的扩展分析方法有
- Fisher精确分析，
- Ridit分析，
- CMH分析。
与卡方分析有关的数据形式主要有
- 四格表检验，
  - 四格表资料是分类资料，属离散型分布，由此计算的卡方值的抽样分布也应当是不连续的，当样本量较小时，两者间的差异不可忽略，应进行连续性校正（在每个单元格的残差中都减去0.5）。
- 无序RC表的卡方检测，
- 单向有序表的卡方检验，
- 双向有序表的卡方检测。

卡方分布是一种连续分布，只有一个参数，即自由度ν，当自由度ν≤2时,卡方分布的曲线呈L形，随着ν的增加，曲线逐渐趋于对称，当自由度无穷大时，接近于正态分布。

```
#当T>=5, n>=40 时，直接用Pearson 卡方检验；
#当1 =<T < 5 , n >= 40 时， 用连续性校正公式；
#当T<1 , 或者 n < 40, 或做卡方检验后所得的P值接近检验水准a 时，用确切概率（Fisher exact test ）。
```

## Yates' Correction for Continuity
卡方分布界值表的依据是卡方分布，其分布是连续型分布，而计数资料中的实际频数为分类资料，是不连续的。因此，计算出来的卡方值查界值表所得的概率P偏小，特别是对自由度为1的四格表资料的影响更大。 为此，美国统计学家F.Yates(1934年）提出了计算卡方的连续性校正法(correction for continuity)


## 三、案例解读
```
df <- read.table("1.txt", sep ="\t", header = T)
rownames(df)<- df$X
df <- df[,-grep("^X$",colnames(df))]
df
#进行不连续校正的卡方检验
result <- chisq.test(df, correct=F)
result

#获取期望次数
expected_count_l1=0
expected_count_g5=0
expected_count_g1l5=0

for (i in as.vector(result$expected)){
    if (i<1){
      expected_count_l1 = expected_count_l1+1
    } else if (i>5){
      expected_count_g5 = expected_count_g5+1
    } else if (i<5 && i>=1){
      expected_count_g1l5 = expected_count_g1l5+1
    }
}

print( paste("The minimum expected count:", min(as.vector(result$expected)), sep = " "))
print(paste("Cells have expected count less than 1:",expected_count_l1, sep = " "))
print(paste("Cells have expected count greater than 1 and less than 5:",expected_count_g1l5, sep = " "))
#print(expected_count_g1l5/length(as.vector(result$expected)))

# 判断使用何种检验
#1. 当T>=5, n>=40 时，直接用Pearson 卡方检验；
#2. 当1 =<T < 5 , n >= 40 时， 用连续性校正公式；
#3. 当T<1 , 或者 n < 40, 或做卡方检验后所得的P值接近检验水准a 时，用确切概率（Fisher exact test ）。

#
if (expected_count_l1 > 0){
   result2 <- fisher.test(df)
   print("Fisher Exact Test Selected")
   print(result2)
   print(paste("P value:", result2$p.value, sep = " "))

} else if (expected_count_g5 > 0){
   result2 <- chisq.test(df, correct=F)
   print(paste("P value:", result2$p.value, sep = " "))
   print(paste("Expected Count", result2$expected, sep = " "))
#sqrt(result2$statistic/(sum(df) + result2$statistic)) # 列联系数
#E <- result2$expected
#O <- result2$observed
#(O-E)^2/E

} else {
   result2 <- result
#sqrt(result2$statistic/(sum(df) + result2$statistic)) # 列联系数
}

```

#### ref_info
https://www.sohu.com/a/217469762_100059586

http://rvdsd.top/2017/06/06/BioStatistics/%E7%94%9F%E7%89%A9%E7%BB%9F%E8%AE%A1-08%E5%8D%A1%E6%96%B9%E5%88%86%E6%9E%90%E4%B8%8E%E5%8D%A1%E6%96%B9%E5%88%86%E5%B8%83/

https://zhuanlan.zhihu.com/p/140043959

https://zhuanlan.zhihu.com/p/49218072

