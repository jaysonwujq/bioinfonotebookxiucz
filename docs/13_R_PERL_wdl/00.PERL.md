<!-- TOC -->

- [安装](#%E5%AE%89%E8%A3%85)
    - [查看参数](#%E6%9F%A5%E7%9C%8B%E5%8F%82%E6%95%B0)
- [安装模块](#%E5%AE%89%E8%A3%85%E6%A8%A1%E5%9D%97)
    - [手工安装](#%E6%89%8B%E5%B7%A5%E5%AE%89%E8%A3%85)
    - [CPAN/perl -MCPAN -e 'install 模块'](#cpanperl--mcpan--e-install-%E6%A8%A1%E5%9D%97)
    - [cpan shell vs.](#cpan-shell-vs)
        - [简单粗暴的初始化cpan，大侠重新来过](#%E7%AE%80%E5%8D%95%E7%B2%97%E6%9A%B4%E7%9A%84%E5%88%9D%E5%A7%8B%E5%8C%96cpan%E5%A4%A7%E4%BE%A0%E9%87%8D%E6%96%B0%E6%9D%A5%E8%BF%87)
        - [cpan -i 模块名](#cpan--i-%E6%A8%A1%E5%9D%97%E5%90%8D)
- [cpanm专题（！！！）](#cpanm%E4%B8%93%E9%A2%98)
    - [mcpan安装和配置](#mcpan%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE)
    - [其他客户端](#%E5%85%B6%E4%BB%96%E5%AE%A2%E6%88%B7%E7%AB%AF)
- [其他问题](#%E5%85%B6%E4%BB%96%E9%97%AE%E9%A2%98)
    - [PERLLIB and PERL5LIB](#perllib-and-perl5lib)
    - [conda的perl和系统的perl冲突](#conda%E7%9A%84perl%E5%92%8C%E7%B3%BB%E7%BB%9F%E7%9A%84perl%E5%86%B2%E7%AA%81)
    - [perl-5.14.0在新版gcc中编译不通过解决办法](#perl-5140%E5%9C%A8%E6%96%B0%E7%89%88gcc%E4%B8%AD%E7%BC%96%E8%AF%91%E4%B8%8D%E9%80%9A%E8%BF%87%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95)
    - [问题](#%E9%97%AE%E9%A2%98)
    - [深入@INC](#%E6%B7%B1%E5%85%A5inc)
    - [Can't locate Module/Build.pm in @INC](#cant-locate-modulebuildpm-in-inc)
        - [Ref_Info](#ref_info)
    - [loadable library and perl binaries are mismatched got handshake key 0xce00080, needed 0xde00080](#loadable-library-and-perl-binaries-are-mismatched-got-handshake-key-0xce00080-needed-0xde00080)
    - [安装Bio::DB::Sam出错](#%E5%AE%89%E8%A3%85biodbsam%E5%87%BA%E9%94%99)
- [遇到问题-------perl无法使用多线程This Perl not built to support threads](#%E9%81%87%E5%88%B0%E9%97%AE%E9%A2%98-------perl%E6%97%A0%E6%B3%95%E4%BD%BF%E7%94%A8%E5%A4%9A%E7%BA%BF%E7%A8%8Bthis-perl-not-built-to-support-threads)
- [perl -V](#perl--v)

<!-- /TOC -->

## 安装

官网：http://www.perl.org/get.html

https://www.activestate.com/activeperl/downloads

https://www.cpan.org/src/5.0/perl-5.28.0.tar.gz

```
方法一：
curl -L http://xrl.us/installperlnix | bash

方法二：
wget -c https://www.cpan.org/src/5.0/perl-5.28.0.tar.gz
tar zxvf 
#./Configure -de -Dprefix=`pwd`
#./Configure -des -Dprefix=`pwd` -Dusethreads -Uversiononly -Dinc_version_list=none
#./Configure -des -Dprefix=/usr/local/perl -Dusethreads -Uinstalluserbinperl -Dcc=gcc

#Configure -Dotherlibdirs=/usr/lib/perl5/site_perl/5.16.3
make -j2
make test
make install

方法三：
sh <(curl -q https://platform.activestate.com/dl/cli/w20598l01/install.sh) --activate-default ActiveState/Perl-5.32
```

### 查看参数
```
perl -V
```

```
#列出所有系统中已经安装的perl模块
perldoc perllocal
perldoc -lm Statistics::Descriptive

find  `perl -e 'print "@INC"'` -name '*.pm'
perl -e '{print "$_\n" foreach @INC}'

set | grep ^PERL
```
## 安装模块
### 1. 手工安装
```
# 从 CPAN(https://metacpan.org/)下载了 BioPerl 模块 1.7.5 版的压缩文件 BioPerl-1.7.5.tar.gz
# 假设放在/usr/local/src/下。
$ cd /usr/local/src

# 解压缩这个文件,这时会新建一个 BioPerl-1.7.5 的目录。
$ tar xvzf BioPerl-1.7.5.tar.gz

# 换到解压后的目录
$ cd BioPerl-1.7.5

# 生成 makefile，如果要指定模块的安装路径，需要添加 PREFIX=/path/to/install 路径
$ perl Makefile.PL (PREFIX=/home/shenweiyan/perl_modules)

# 生成模块
$ make

# 测试模块(这步可有可无)：
$ make test

# 如果测试结果报告"all test ok"，您就可以放心地安装编译好的模块了。
# 安装模块前，先要确保您对 perl5 安装目录有可写权限(通常以 su 命令获得)，执行：
$ make install

# 现在，试试 Bio::SeqIO 模块吧。如果下面的命令没有给出任何输出，那就没问题。
$ perl -MBio::SeqIO -e1

# 如果指定 PREFIX 安装路径，模块安装完成后，需要把模块安装的新路径添加到 PERL5LIB 环境变量
$ export PERL5LIB=$PERL5LIB:/home/shenweiyan/perl_modules/lib/site_perl  //或者把该行内容添加到 ~/.bashrc
```
### 2. CPAN/perl -MCPAN -e 'install 模块'()
```
#查看全部配置
cpan[1]> o conf
#增加源
cpan[1]> o conf urllist push https://mirrors.aliyun.com/CPAN/
#提交修改
cpan[2]> o conf commit
#重新初始化
cpan[1]> o conf init
#设置模块安装位置
cpan[1]> o conf makepl_arg INSTALL_BASE=/public/frasergen/MED/software/zhangbo/PERL/perl-5.28.2/
cpan[2]> o conf mbuild_arg "--install_base /public/frasergen/MED/software/zhangbo/PERL/perl-5.28.2/"
cpan[3]> o conf commit
#查看某个模块安装路径
[fszb@hlogin09 perl5]$ perldoc -l DBI
/usr/lib64/perl5/vendor_perl/DBI.pm

#修改make和build的执行方式，加上sudo。这主要是针对非root用户的
o conf make_install_make_command 'sudo /usr/bin/make'
o conf mbuild_install_build_command 'sudo ./Build'

```

### 3. cpan shell vs. 

#### 简单粗暴的初始化cpan，大侠重新来过
`直接删除 ~/.cpan/`

#### cpan -i 模块名

## cpanm专题（！！！）
### mcpan安装和配置
```
# wget http://xrl.us/cpanm -O /usr/bin/cpanm; chmod +x /usr/bin/cpanm

export PERL_CPANM_OPT="--prompt --reinstall -l /public/frasergen/MED/software/zhangbo/PERL/perl-5.28.2/cpanm/ --mirror http://cpan.cpantesters.org" 
export PERL5LIB=public/frasergen/MED/software/zhangbo/PERL/perl-5.28.2/cpanm/lib/perl5:$PERL5LIB #添加lib环境变量

```
```
find  `perl -e 'print "@INC"'` -name '*.pm'
mkdir -p /public/frasergen/MED/software/zhangbo/PERL/perl-5.28.2/cpanm
export PERL5LIB=$PERL5LIB:/public/frasergen/MED/software/zhangbo/PERL/perl-5.28.2/cpanm/lib/perl5
/public/frasergen/MED/software/zhangbo/PERL/cpanm -l /public/frasergen/MED/software/zhangbo/PERL/perl-5.28.2/cpanm Set::IntervalTree
```

### 其他客户端
+ CPAN客户端：CPANPLUS模块

## 其他问题

### 1. PERLLIB and PERL5LIB

I'd recommend using PERL5LIB over PERLLIB as that makes it clear it is related to Perl 5)
```
use lib qw(./modulos/share/perl/5.8.8/); # You may need to change this path
use module::name;
```

### 2. conda的perl和系统的perl冲突
```
perl: symbol lookup error: /home/wangjw/perl5/lib/perl5/x86_64-linux-thread-multi/auto/Cwd/Cwd.so: undefined symbol
```
这个问题显然我用系统perl安装的软件被conda的perl有限查找到导致，用`perl -V`和`perl -e '{print "$_\n" foreach` @INC}'可以发现conda的perl查找路径低于我为系统perl安装的路径，解决方案如下。（如果我们手动安装的包，或者安装到了一个非默认的查找路径下(例如不同用户安装到了不同家目录下)，这时可以通过在shell中设置PERL5LIB环境变量，perl会临时从这个环境变量中去查找模块。）
export PERL5LIB=""



https://www.jianshu.com/p/9e90b3524fe2
https://cloud.tencent.com/developer/article/1055044
https://codeday.me/bug/20181210/431702.html
https://yq.aliyun.com/articles/650551


### perl-5.14.0在新版gcc中编译不通过解决办法

$ make
......
make[1]: *** [IO.o] Error 1
make[1]: Leaving directory `/users/rmi1/build/perl-5.12.0/dist/IO'
Unsuccessful make(dist/IO): code=512 at make_ext.pl line 449.
make: *** [lib/auto/IO/IO.so] Error 2


如果在 make 编译过程中出现如上报错，请参考 Make error when compiling Perl 5.12.1 (RHEL 5.5) 执行下面操作：
printenv C_INCLUDE_PATH
$ make clean
$ unset C_INCLUDE_PATH
$ ./Configure -des -Dprefix=/usr/local/software/Perl-5.26 -Dusethreads -Uversiononly
$ make


由于在新版本中GCC把C99中的标准库分成了libc和libm两个部分，libm中包含一些数学库等，如果要用到libm时，必须加上-lm选项。在解压Configure之后，再在Makefile中，LDFLAGS 和 CLDFLAGS两个参数后面加上 -lm即可解决问题
参考：http://serverfault.com/questions/145288/make-error-when-compiling-perl-5-12-1-rhel-5-5
```
     修改 dist/IO/poll.h：将 #include<poll.h> 修改为 #include<sys/poll.h>
```
参考：http://blog.163.com/zhangliye_2009/blog/static/1223120282013518104148904/
```
     在Makefile 中，LDFLAGS 和 CLDFLAGS两个参数后面加上 -lrt
```

### 问题
Ref_Info
http://www.bio-info-trainee.com/1600.html

http://www.bio-info-trainee.com/2451.html

### 深入@INC
@INC 是perl 的一个特殊列表标量，他储存着你当前版本的Perl模块的路径。编译时，Perl会根据@INC存储的路径去查询用户所调用的模块。具体的是那些目录。通过命令行键入'perl -V' 来查看，我们同样可以再BEGIN代码块里对这个@INC进行操作。可以看到Perl会从这5个目录下面去找模块，其中”.”代表当前目录下。


### 3.1. Can't locate Module/Build.pm in @INC

#### Ref_Info
+ https://perlmaven.com/cant-locate-in-inc
+ How to change @INC to find Perl modules in non-standard locations：
+ https://perlmaven.com/how-to-change-inc-to-find-perl-modules-in-non-standard-locations
+ How to add a relative directory to @INC
+ https://perlmaven.com/how-to-add-a-relative-directory-to-inc
+ 

http://blog.sciencenet.cn/blog-2609994-901980.html

### 3.2 loadable library and perl binaries are mismatched (got handshake key 0xce00080, needed 0xde00080)

env | grep PERL


Related: stackoverflow.com/questions/45000585/… . Make sure PERL5LIB or PERL_LOCAL_LIB_ROOT aren't referring to any directories with old distributions in them. – mob Apr 3 '19 at 0:21

### 3.3 安装Bio::DB::Sam出错
```
wget http://sourceforge.net/projects/samtools/files/samtools/0.1.18/samtools-0.1.18.tar.bz2

tar xjf samtools-0.1.18.tar.bz2 && cd samtools-0.1.18

make CFLAGS=-fPIC
```

1.
This is a Perl interface to the SAMtools sequence alignment interface. It ONLY works on versions of Samtools up to 0.1.17. It does not work on version 1.0 or higher due to major changes in the library structure.
2.
 I recommend you use Bio::DB::HTS instead, which is based on Bio::DB::Sam. Bio::DB::HTS 

https://stackoverflow.com/questions/25556178/installing-biodbsam-perl-module/25611671#25611671
https://stackoverflow.com/questions/25556178/installing-biodbsam-perl-module

## 遇到问题-------perl无法使用多线程This Perl not built to support threads
https://codejzy.com/posts-2999068.html

## perl -V
```
perl: warning: Setting locale failed.
perl: warning: Please check that your locale settings:
	LANGUAGE = (unset),
	LC_ALL = (unset),
	LC_CTYPE = "UTF-8",
	LANG = "en_US.UTF-8"
    are supported and installed on your system.
perl: warning: Falling back to the standard locale ("C").
Summary of my perl5 (revision 5 version 16 subversion 3) configuration:

  Platform:
    osname=linux, osvers=3.10.0-693.17.1.el7.x86_64, archname=x86_64-linux-thread-multi
    uname='linux x86-01.bsys.centos.org 3.10.0-693.17.1.el7.x86_64 #1 smp thu jan 25 20:13:58 utc 2018 x86_64 x86_64 x86_64 gnulinux '
    config_args='-des -Doptimize=-O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector-strong --param=ssp-buffer-size=4 -grecord-gcc-switches   -m64 -mtune=generic -Dccdlflags=-Wl,--enable-new-dtags -Dlddlflags=-shared -O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector-strong --param=ssp-buffer-size=4 -grecord-gcc-switches   -m64 -mtune=generic -Wl,-z,relro  -DDEBUGGING=-g -Dversion=5.16.3 -Dmyhostname=localhost -Dperladmin=root@localhost -Dcc=gcc -Dcf_by=Red Hat, Inc. -Dprefix=/usr -Dvendorprefix=/usr -Dsiteprefix=/usr/local -Dsitelib=/usr/local/share/perl5 -Dsitearch=/usr/local/lib64/perl5 -Dprivlib=/usr/share/perl5 -Dvendorlib=/usr/share/perl5/vendor_perl -Darchlib=/usr/lib64/perl5 -Dvendorarch=/usr/lib64/perl5/vendor_perl -Darchname=x86_64-linux-thread-multi -Dlibpth=/usr/local/lib64 /lib64 /usr/lib64 -Duseshrplib -Dusethreads -Duseithreads -Dusedtrace=/usr/bin/dtrace -Duselargefiles -Dd_semctl_semun -Di_db -Ui_ndbm -Di_gdbm -Di_shadow -Di_syslog -Dman3ext=3pm -Duseperlio -Dinstallusrbinperl=n -Ubincompat5005 -Uversiononly -Dpager=/usr/bin/less -isr -Dd_gethostent_r_proto -Ud_endhostent_r_proto -Ud_sethostent_r_proto -Ud_endprotoent_r_proto -Ud_setprotoent_r_proto -Ud_endservent_r_proto -Ud_setservent_r_proto -Dscriptdir=/usr/bin -Dusesitecustomize'
    hint=recommended, useposix=true, d_sigaction=define
    useithreads=define, usemultiplicity=define
    useperlio=define, d_sfio=undef, uselargefiles=define, usesocks=undef
    use64bitint=define, use64bitall=define, uselongdouble=undef
    usemymalloc=n, bincompat5005=undef
  Compiler:
    cc='gcc', ccflags ='-D_REENTRANT -D_GNU_SOURCE -fno-strict-aliasing -pipe -fstack-protector -I/usr/local/include -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64',
    optimize='-O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector-strong --param=ssp-buffer-size=4 -grecord-gcc-switches -m64 -mtune=generic',
    cppflags='-D_REENTRANT -D_GNU_SOURCE -fno-strict-aliasing -pipe -fstack-protector -I/usr/local/include'
    ccversion='', gccversion='4.8.5 20150623 (Red Hat 4.8.5-36)', gccosandvers=''
    intsize=4, longsize=8, ptrsize=8, doublesize=8, byteorder=12345678
    d_longlong=define, longlongsize=8, d_longdbl=define, longdblsize=16
    ivtype='long', ivsize=8, nvtype='double', nvsize=8, Off_t='off_t', lseeksize=8
    alignbytes=8, prototype=define
  Linker and Libraries:
    ld='gcc', ldflags =' -fstack-protector'
    libpth=/usr/local/lib64 /lib64 /usr/lib64
    libs=-lresolv -lnsl -lgdbm -ldb -ldl -lm -lcrypt -lutil -lpthread -lc -lgdbm_compat
    perllibs=-lresolv -lnsl -ldl -lm -lcrypt -lutil -lpthread -lc
    libc=, so=so, useshrplib=true, libperl=libperl.so
    gnulibc_version='2.17'
  Dynamic Linking:
    dlsrc=dl_dlopen.xs, dlext=so, d_dlsymun=undef, ccdlflags='-Wl,--enable-new-dtags -Wl,-rpath,/usr/lib64/perl5/CORE'
    cccdlflags='-fPIC', lddlflags='-shared -O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector-strong --param=ssp-buffer-size=4 -grecord-gcc-switches -m64 -mtune=generic -Wl,-z,relro '


Characteristics of this binary (from libperl):
  Compile-time options: HAS_TIMES MULTIPLICITY PERLIO_LAYERS
                        PERL_DONT_CREATE_GVSV PERL_IMPLICIT_CONTEXT
                        PERL_MALLOC_WRAP PERL_PRESERVE_IVUV USE_64_BIT_ALL
                        USE_64_BIT_INT USE_ITHREADS USE_LARGE_FILES
                        USE_LOCALE USE_LOCALE_COLLATE USE_LOCALE_CTYPE
                        USE_LOCALE_NUMERIC USE_PERLIO USE_PERL_ATOF
                        USE_REENTRANT_API USE_SITECUSTOMIZE
  Locally applied patches:
	Fedora Patch1: Removes date check, Fedora/RHEL specific
	Fedora Patch3: support for libdir64
	Fedora Patch4: use libresolv instead of libbind
	Fedora Patch5: USE_MM_LD_RUN_PATH
	Fedora Patch6: Skip hostname tests, due to builders not being network capable
	Fedora Patch7: Dont run one io test due to random builder failures
	Fedora Patch9: Fix find2perl to translate ? glob properly (RT#113054)
	Fedora Patch10: Fix broken atof (RT#109318)
	Fedora Patch13: Clear $@ before "do" I/O error (RT#113730)
	Fedora Patch14: Do not truncate syscall() return value to 32 bits (RT#113980)
	Fedora Patch15: Override the Pod::Simple::parse_file (CPANRT#77530)
	Fedora Patch16: Do not leak with attribute on my variable (RT#114764)
	Fedora Patch17: Allow operator after numeric keyword argument (RT#105924)
	Fedora Patch18: Extend stack in File::Glob::glob, (RT#114984)
	Fedora Patch19: Do not crash when vivifying $|
	Fedora Patch20: Fix misparsing of maketext strings (CVE-2012-6329)
	Fedora Patch21: Add NAME headings to CPAN modules (CPANRT#73396)
	Fedora Patch22: Fix leaking tied hashes (RT#107000) [1]
	Fedora Patch23: Fix leaking tied hashes (RT#107000) [2]
	Fedora Patch24: Fix leaking tied hashes (RT#107000) [3]
	Fedora Patch25: Fix dead lock in PerlIO after fork from thread (RT#106212)
	Fedora Patch26: Make regexp safe in a signal handler (RT#114878)
	Fedora Patch27: Update h2ph(1) documentation (RT#117647)
	Fedora Patch28: Update pod2html(1) documentation (RT#117623)
	Fedora Patch29: Document Math::BigInt::CalcEmu requires Math::BigInt (CPAN RT#85015)
	RHEL Patch30: Use stronger algorithm needed for FIPS in t/op/crypt.t (RT#121591)
	RHEL Patch31: Make *DBM_File desctructors thread-safe (RT#61912)
	RHEL Patch32: Use stronger algorithm needed for FIPS in t/op/taint.t (RT#123338)
	RHEL Patch33: Remove CPU-speed-sensitive test in Benchmark test
	RHEL Patch34: Make File::Glob work with threads again
	RHEL Patch35: Fix CRLF conversion in ASCII FTP upload (CPAN RT#41642)
	RHEL Patch36: Do not leak the temp utf8 copy of namepv (CPAN RT#123786)
	RHEL Patch37: Fix duplicating PerlIO::encoding when spawning threads (RT#31923)
	RHEL Patch38: Add SSL support to Net::SMTP (CPAN RT#93823) [1]
	RHEL Patch39: Add SSL support to Net::SMTP (CPAN RT#93823) [2]
	RHEL Patch40: Add SSL support to Net::SMTP (CPAN RT#93823) [3]
	RHEL Patch41: Add SSL support to Net::SMTP (CPAN RT#93823) [4]
	RHEL Patch42: Do not overload ".." in Math::BigInt (CPAN RT#80182)
  Built under linux
  Compiled at Oct 30 2018 18:59:43
  %ENV:
    PERL5LIB="/public/home/fsmed/perl5/lib/perl5:"
    PERL_LOCAL_LIB_ROOT=":/public/home/fsmed/perl5"
    PERL_MB_OPT="--install_base /public/home/fsmed/perl5"
    PERL_MM_OPT="INSTALL_BASE=/public/home/fsmed/perl5"
  @INC:
    /public/home/fsmed/perl5/lib/perl5
    /usr/local/lib64/perl5
    /usr/local/share/perl5
    /usr/lib64/perl5/vendor_perl
    /usr/share/perl5/vendor_perl
    /usr/lib64/perl5
    /usr/share/perl5
    .
```