<!-- TOC -->

- [安装](#安装)
  - [查看参数](#查看参数)
- [安装模块](#安装模块)
  - [手工安装](#手工安装)
  - [CPAN/perl -MCPAN -e 'install 模块'()](#cpanperl--mcpan--e-install-模块)
  - [大侠重新来过](#大侠重新来过)
    - [cpan -i 模块名](#cpan--i-模块名)
  - [其他客户端](#其他客户端)
- [其他问题](#其他问题)
  - [conda的perl和系统的perl冲突](#conda的perl和系统的perl冲突)
  - [PERLLIB and PERL5LIB](#perllib-and-perl5lib)
  - [perl-5.14.0在新版gcc中编译不通过解决办法](#perl-5140在新版gcc中编译不通过解决办法)
  - [问题](#问题)
  - [3.1. Can't locate Module/Build.pm in @INC](#31-cant-locate-modulebuildpm-in-inc)
    - [Ref_Info](#ref_info)

<!-- /TOC -->

## 安装

官网：http://www.perl.org/get.html

https://www.activestate.com/activeperl/downloads

https://www.cpan.org/src/5.0/perl-5.28.0.tar.gz

```
方法一：
curl -L http://xrl.us/installperlnix | bash

方法二：
wget -c https://www.cpan.org/src/5.0/perl-5.28.0.tar.gz
tar zxvf 
#./Configure -de -Dprefix=`pwd`
#./Configure -des -Dprefix=`pwd` -Dusethreads -Uversiononly -Dinc_version_list=none  
make -j2
make test
make install

方法三：
sh <(curl -q https://platform.activestate.com/dl/cli/w20598l01/install.sh) --activate-default ActiveState/Perl-5.32
```

### 初始化cpan/mcpan
```
mkdir -p /public/frasergen/MED/software/zhangbo/PERL/perl-5.28.2/cpanm
export PERL5LIB=$PERL5LIB:/public/frasergen/MED/software/zhangbo/PERL/perl-5.28.2/cpanm/lib/perl5
/public/frasergen/MED/software/zhangbo/PERL/cpanm -l /public/frasergen/MED/software/zhangbo/PERL/perl-5.28.2/cpanm Set::IntervalTree
```


### 查看参数
```
perl -V
```
@INC 是perl 的一个特殊列表标量，他储存着你当前版本的Perl模块的路径。编译时，Perl会根据@INC存储的路径去查询用户所调用的模块。具体的是那些目录。通过命令行键入'perl -V' 来查看，我们同样可以再BEGIN代码块里对这个@INC进行操作。可以看到Perl会从这5个目录下面去找模块，其中”.”代表当前目录下。

```
#列出所有系统中已经安装的perl模块
perldoc perllocal
instmodsh
find  `perl -e 'print "@INC"'` -name '*.pm'
```
## 安装模块
### 手工安装
```
# 从 CPAN(https://metacpan.org/)下载了 BioPerl 模块 1.7.5 版的压缩文件 BioPerl-1.7.5.tar.gz
# 假设放在/usr/local/src/下。
$ cd /usr/local/src

# 解压缩这个文件,这时会新建一个 BioPerl-1.7.5 的目录。
$ tar xvzf BioPerl-1.7.5.tar.gz

# 换到解压后的目录
$ cd BioPerl-1.7.5

# 生成 makefile，如果要指定模块的安装路径，需要添加 PREFIX=/path/to/install 路径
$ perl Makefile.PL (PREFIX=/home/shenweiyan/perl_modules)

# 生成模块
$ make

# 测试模块(这步可有可无)：
$ make test

# 如果测试结果报告"all test ok"，您就可以放心地安装编译好的模块了。
# 安装模块前，先要确保您对 perl5 安装目录有可写权限(通常以 su 命令获得)，执行：
$ make install

# 现在，试试 Bio::SeqIO 模块吧。如果下面的命令没有给出任何输出，那就没问题。
$ perl -MBio::SeqIO -e1

# 如果指定 PREFIX 安装路径，模块安装完成后，需要把模块安装的新路径添加到 PERL5LIB 环境变量
$ export PERL5LIB=$PERL5LIB:/home/shenweiyan/perl_modules/lib/site_perl  //或者把该行内容添加到 ~/.bashrc
```
### CPAN/perl -MCPAN -e 'install 模块'()
```
#查看全部配置
cpan[1]> o conf
#增加源
cpan[1]> o conf urllist push https://mirrors.aliyun.com/CPAN/
#提交修改
cpan[2]> o conf commit
#重新初始化
cpan[1]> o conf init
#设置模块安装位置
cpan[1]> o conf makepl_arg INSTALL_BASE=/public/frasergen/MED/software/zhangbo/PERL/perl-5.28.2/
cpan[2]> o conf mbuild_arg "--install_base /public/frasergen/MED/software/zhangbo/PERL/perl-5.28.2/"
cpan[3]> o conf commit
#查看某个模块安装路径
[fszb@hlogin09 perl5]$ perldoc -l DBI
/usr/lib64/perl5/vendor_perl/DBI.pm

#修改make和build的执行方式，加上sudo。这主要是针对非root用户的
o conf make_install_make_command 'sudo /usr/bin/make'
o conf mbuild_install_build_command 'sudo ./Build'

```

### 大侠重新来过
`直接删除 ~/.cpan/`

#### cpan -i 模块名
### 其他客户端
+ CPAN客户端：cpanm
+ CPAN客户端：CPANPLUS模块


## 其他问题
### conda的perl和系统的perl冲突
```
perl: symbol lookup error: /home/wangjw/perl5/lib/perl5/x86_64-linux-thread-multi/auto/Cwd/Cwd.so: undefined symbol
```
这个问题显然我用系统perl安装的软件被conda的perl有限查找到导致，用`perl -V`和`perl -e '{print "$_\n" foreach` @INC}'可以发现conda的perl查找路径低于我为系统perl安装的路径，解决方案如下。（如果我们手动安装的包，或者安装到了一个非默认的查找路径下(例如不同用户安装到了不同家目录下)，这时可以通过在shell中设置PERL5LIB环境变量，perl会临时从这个环境变量中去查找模块。）
export PERL5LIB=""



https://www.jianshu.com/p/9e90b3524fe2
https://cloud.tencent.com/developer/article/1055044
https://codeday.me/bug/20181210/431702.html
https://yq.aliyun.com/articles/650551

### PERLLIB and PERL5LIB

I'd recommend using PERL5LIB over PERLLIB as that makes it clear it is related to Perl 5)


### perl-5.14.0在新版gcc中编译不通过解决办法

$ make
......
make[1]: *** [IO.o] Error 1
make[1]: Leaving directory `/users/rmi1/build/perl-5.12.0/dist/IO'
Unsuccessful make(dist/IO): code=512 at make_ext.pl line 449.
make: *** [lib/auto/IO/IO.so] Error 2


如果在 make 编译过程中出现如上报错，请参考 Make error when compiling Perl 5.12.1 (RHEL 5.5) 执行下面操作：
printenv C_INCLUDE_PATH
$ make clean
$ unset C_INCLUDE_PATH
$ ./Configure -des -Dprefix=/usr/local/software/Perl-5.26 -Dusethreads -Uversiononly
$ make


由于在新版本中GCC把C99中的标准库分成了libc和libm两个部分，libm中包含一些数学库等，如果要用到libm时，必须加上-lm选项。在解压Configure之后，再在Makefile中，LDFLAGS 和 CLDFLAGS两个参数后面加上 -lm即可解决问题
参考：http://serverfault.com/questions/145288/make-error-when-compiling-perl-5-12-1-rhel-5-5
```
     修改 dist/IO/poll.h：将 #include<poll.h> 修改为 #include<sys/poll.h>
```
参考：http://blog.163.com/zhangliye_2009/blog/static/1223120282013518104148904/
```
     在Makefile 中，LDFLAGS 和 CLDFLAGS两个参数后面加上 -lrt
```

### 问题
Ref_Info
http://www.bio-info-trainee.com/1600.html

http://www.bio-info-trainee.com/2451.html

### 3.1. Can't locate Module/Build.pm in @INC

#### Ref_Info
+ https://perlmaven.com/cant-locate-in-inc
+ How to change @INC to find Perl modules in non-standard locations：
+ https://perlmaven.com/how-to-change-inc-to-find-perl-modules-in-non-standard-locations
+ How to add a relative directory to @INC
+ https://perlmaven.com/how-to-add-a-relative-directory-to-inc
+ 

http://blog.sciencenet.cn/blog-2609994-901980.html

3.2 loadable library and perl binaries are mismatched (got handshake key 0xce00080, needed 0xde00080)

env | grep PERL


Related: stackoverflow.com/questions/45000585/… . Make sure PERL5LIB or PERL_LOCAL_LIB_ROOT aren't referring to any directories with old distributions in them. – mob Apr 3 '19 at 0:21

3.3 安装Bio::DB::Sam出错



1.
This is a Perl interface to the SAMtools sequence alignment interface. It ONLY works on versions of Samtools up to 0.1.17. It does not work on version 1.0 or higher due to major changes in the library structure.
2.
 I recommend you use Bio::DB::HTS instead, which is based on Bio::DB::Sam. Bio::DB::HTS 

https://stackoverflow.com/questions/25556178/installing-biodbsam-perl-module/25611671#25611671
