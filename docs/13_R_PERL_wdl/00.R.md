# 安装

> https://mirrors.tuna.tsinghua.edu.cn/CRAN/src/base/R-4/R-4.1.0.tar.gz 
> https://mirrors.tuna.tsinghua.edu.cn/CRAN/src/base/R-3/R-3.6.3.tar.gz

## 安装R3
```
wget -c https://mirrors.tuna.tsinghua.edu.cn/CRAN/src/base/R-3/R-3.6.2.tar.gz
--enable-R-shlib --enable-memory-profiling --prefix= #对于R3版本
make -j 8
make install 
```

> https://mirrors.tuna.tsinghua.edu.cn/CRAN/src/base/R-3/R-3.6.3.tar.gz

## 安装R4
```
--enable-R-shlib --enable-memory-profiling --prefix= --with-pcre1 #对于R4版本以上
#$ ./configure --enable-R-shlib --enable-memory-profiling --prefix=`pwd` --with-pcre1
```

报错1
```
configure: error: libcurl >= 7.28.0 library and headers are required with support for https
```
去掉conda环境再安装

报错2
```
checking whether PCRE support suffices... no
configure: error: PCRE2 library and headers are required, or use --with-pcre1 and PCRE >= 8.32 with UTF-8 support
```

```
wget https://ftp.pcre.org/pub/pcre/pcre-8.40.tar.gz --no-check-certificate
$ tar -zxvf pcre-8.40.tar.gz
$ cd pcre-8.40
$ ./configure --prefix=/disks/software/pcre-8.4 --enable-utf8
$ make -j3 && make install

export PATH="/public/frasergen/MED/software/zhangbo/R/pcre-8.40:$PATH"
[fszb@hlogin09 R-4.1.0]$ ./configure --enable-R-shlib=yes --enable-memory-profiling --prefix=`pwd` --with-pcre1
```
> https://cran.r-project.org/bin/linux/ubuntu/README.html
> https://mirrors.tuna.tsinghua.edu.cn/CRAN/src/base/R-4/
> https://mirrors.tuna.tsinghua.edu.cn/CRAN/src/base/R-4/R-4.1.0.tar.gz 


```
[fszb@hlogin09 R-4.1.0]$ ./configure --enable-R-shlib --enable-memory-profiling --prefix=`pwd` --with-pcre1

```

```
checking whether PCRE support suffices... no
configure: error: PCRE2 library and headers are required, or use --with-pcre1 and PCRE >= 8.32 with UTF-8 support
```

```
wget https://ftp.pcre.org/pub/pcre/pcre-8.40.tar.gz --no-check-certificate
$ tar -zxvf pcre-8.40.tar.gz
$ cd pcre-8.40
$ ./configure --prefix=/disks/software/pcre-8.4 --enable-utf8
$ make -j3 && make install

export PATH="/public/frasergen/MED/software/zhangbo/R/pcre-8.40:$PATH"
[fszb@hlogin09 R-4.1.0]$ ./configure --enable-R-shlib=yes --enable-memory-profiling --prefix=`pwd` --with-pcre1
```


## 镜像切换

```
rm(list = ls()) 
options()$repos 
options()$BioC_mirror
options(BioC_mirror="https://mirrors.ustc.edu.cn/bioc/")
options("repos" = c(CRAN="https://mirrors.tuna.tsinghua.edu.cn/CRAN/"))
options()$repos 
options()$BioC_mirror

source("https://bioconductor.org/biocLite.R")
biocLite("TCGAbiolinks")
library("TCGAbiolinks")
```

## windows下更新R
可以通过Rstudio 更新R，也可以在R console中更新,只需要三步：
```
1，install.packages("installr ")
2，require(installr)
3,updateR()
```


## .libPaths()
https://stackoverflow.com/questions/15217758/remove-a-library-from-libpaths-permanently-without-rprofile-site



# R包安装

## png包 
```

install.packages('png')
```
https://stackoverflow.com/questions/47424249/unable-to-install-the-package-png-on-r-possible-conflict-with-anaconda/50935430


## 安装r中的报错
https://www.jianshu.com/p/edb234eed915

### 
```
configure: error: libcurl >= 7.28.0 library and headers are required with support for https
```
https://zhuanlan.zhihu.com/p/44841273


##  magick包安装
#### 使用conda安装
```
conda install -c conda-forge r-magick

conda install -c conda-forge imagemagick

conda install -c conda-forge libmagic
conda install -c conda-forge/label/gcc7 libmagic
conda install -c conda-forge/label/cf201901 libmagic
conda install -c conda-forge/label/cf202003 libmagic
```
#### 不适用conda安装
```
export PKG_CONFIG_PATH=/local_data1/MED/programs/R/ImageMagick-7.0.10-34/lib/pkgconfig/:$PKG_CONFIG_PATH
export LD_LIBRARY_PATH=/local_data1/MED/programs/R/ImageMagick-7.0.10-34/lib/:$LD_LIBRARY_PATH
devtools::install_github("ropensci/magick")
```

```
两种情况，如果你只是想加上某库的pkg，则选择下面其一：
export PKG_CONFIG_PATH=/usr/lib/pkgconfig/ 
或者 
export PKG_CONFIG_LIBDIR=/usr/lib/pkgconfig/ 
如果你想覆盖掉原来的pkg,选择后者。因为：
PKG_CONFIG_LIBDIR的优先级比 PKG_CONFIG_PATH 高，所以会覆盖PKG_CONFIG_PATH的设置。
也可以使用如下命令，注意一定要放在PKG_CONFIG_PATH的前面，这样才能首先读取。
 $ export PKG_CONFIG_PATH=/usr/lib/pkgconfig/:$PKG_CONFIG_PATH
 
可以通过下面命令查看
$ echo $PKG_CONFIG_PATH
```

## R包安装中出现诸如“non-zero exit status”情况的报错信息，
https://www.jianshu.com/p/4beb3d34ced2
```
unlink("C:/software/R/R-4.0.2/library/00LOCK-backports", recursive = TRUE).

```


###   libpng16.so.16: cannot open shared object file: No such file or directory
```
https://sourceforge.net/projects/libpng/files/
```

## units包安装
```
# 方法一
#install.packages(
# "udunits2",
#   configure.args = '--with-udunits2-include=/public/frasergen/MED/software/R/R_dependency/udunits-2.2.28/include'
#)


# 方法二
#如果是conda安装 该怎么找路径 > config <- c(units="--with-udunits2-lib=/path/to/home/directory/miniconda3/lib --with-udunits2-include=/path/to/home/directory/miniconda3/include")

> config <- c(units="--with-udunits2-lib=/public/frasergen/MED/software/R/R_dependency/udunits-2.2.28/lib --with-udunits2-include=/public/frasergen/MED/software/R/R_dependency/udunits-2.2.28/include")
> options(configure.args=config)
> install.packages("units")
```
还是失败了`libudunits2.so.0: cannot open shared object file: No such file or directory`

```
> Sys.getenv("LD_LIBRARY_PATH")
udunits_dir = "/public/frasergen/MED/software/R/R_dependency/udunits-2.2.28"
Sys.setenv(LD_LIBRARY_PATH=paste0(Sys.getenv("LD_LIBRARY_PATH"), ":", udunits_dir, "/local/lib"))
install.packages("udunits2", 
                 type = "source",
                 configure.args = c(paste0("--with-udunits2-include=", udunits_dir, "/local/include"), 
                                    paste0("--with-udunits2-lib=", udunits_dir, "/local/lib")),
                 repos = "http://cran.rstudio.com")
dyn.load(paste0(udunits_dir, "/local/lib/libudunits2.so.0"))
install.packages("units", repos = "http://cran.rstudio.com",
             configure.args = c(paste0("--with-udunits2-include=", udunits_dir, "/local/include"), 
                                paste0("--with-udunits2-lib=", udunits_dir, "/local/lib")))


#方法三
export UDUNITS2_INCLUDE=/public/frasergen/MED/software/R/R_dependency/udunits-2.2.28/include
export UDUNITS2_LIBS=/public/frasergen/MED/software/R/R_dependency/udunits-2.2.28/lib
```



### Configuration failed because libudunits2.so was not found. Try installing:
```
$ wget -c https://artifacts.unidata.ucar.edu/repository/downloads-udunits/udunits-2.2.28.tar.gz
$ tar xf udunits-2.2.26.tar.gz
$ ./configure --prefix=`pwd` && make && make install
```

## sf包安装
### configure: error: gdal-config not found or not executable.

```
#  git clone https://github.com/OSGeo/gdal
wget http://download.osgeo.org/gdal/2.1.1/gdal-2.1.1.tar.gz
tar xvf gdal-2.1.1.tar.gz

export PATH="/public/frasergen/MED/software/R/R_dependency/gdal-2.1.1/bin/:$PATH"
export PATH="/public/frasergen/MED/software/R/R_dependency/gdal-2.1.1/lib/:$PATH"
export PKG_CONFIG_PATH=/public/frasergen/MED/software/R/R_dependency/gdal-2.1.1/lib/pkgconfig
```
还是报错，`gdal_proj: error while loading shared libraries: libgdal.so.20: cannot open shared object file: No such file or directory`

```
#https://download.osgeo.org/proj/
wget -c https://download.osgeo.org/proj/proj-8.1.1.tar.gz --no-check-certificate

```
报错`Requested 'sqlite3 >= 3.11' but version of SQLite is 3.7.17`
```
wget -c https://www.sqlite.org/snapshot/sqlite-snapshot-202110132029.tar.gz --no-check-certificate

export SQLITE3_LIBS=/public/frasergen/MED/software/R/R_dependency/sqlite-snapshot-202110132029/lib #
```

继续安装
```
./.libs/libproj.so: undefined reference to `sqlite3_bind_text'
./.libs/libproj.so: undefined reference to `sqlite3_vfs_find'
./.libs/libproj.so: undefined reference to `sqlite3_step'
./.libs/libproj.so: undefined reference to `sqlite3_vfs_unregister'
./.libs/libproj.so: undefined reference to `sqlite3_column_count'
./.libs/libproj.so: undefined reference to `sqlite3_errmsg'
./.libs/libproj.so: undefined reference to `sqlite3_value_type'
./.libs/libproj.so: undefined reference to `sqlite3_snprintf'
./.libs/libproj.so: undefined reference to `sqlite3_value_int64'
./.libs/libproj.so: undefined reference to `sqlite3_prepare_v2'
./.libs/libproj.so: undefined reference to `sqlite3_vsnprintf'
./.libs/libproj.so: undefined reference to `sqlite3_column_double'
collect2: error: ld returned 1 exit status
make[2]: *** [proj] Error 1
make[2]: Leaving directory `/public/frasergen/MED/software/R/R_dependency/proj-6.3.2/src'
make[1]: *** [all] Error 2
make[1]: Leaving directory `/public/frasergen/MED/software/R/R_dependency/proj-6.3.2/src'
make: *** [all-recursive] Error 1

#经过指导后，上面的才是报错，未定义，您看一下这些未定义的字符段是哪个库里面的，然后指定一下库路径试试
#nm -A /public/frasergen/MED/software/R/R_dependency/sqlite-snapshot-202110132029/lib/lib* | grep 其中一个，看是否有定义


#./configure --prefix=`pwd` LDFLAGS=-L/public/frasergen/MED/software/R/R_dependency/sqlite-snapshot-202110132029/lib #需要更换安装文件夹

./configure --prefix=/public/frasergen/MED/software/R/R_dependency/proj-6.3.2-install  LDFLAGS=-L/public/frasergen/MED/software/R/R_dependency/sqlite-snapshot-202110132029/lib LIBS=-lsqlite3
```
成功, 继续安装sf包，
```
export PATH="/public/frasergen/MED/software/R/R_dependency/proj-6.3.2-install/bin/:$PATH"

https://r-spatial.github.io/sf/
```
放弃，用conda安装。

## rgdal包安装
报错`configure: error: GDAL >= 3 should be used with PROJ >= 6, use --with-proj_api="proj_api.h" for deprecated API`



## apa包安装
`Error: C++14 standard requested but CXX14 is not defined`

> https://blog.csdn.net/Damonyugg/article/details/112481346


## 编辑R函数
```
> library(ggpubr)
Loading required package: ggplot2
>
> trace(ggpubr:::.cor_test, edit=TRUE)

```
----

```
#install.packages("rgdal", configure.args=c("--with-proj-include=/home/nikhail1/bin/proj-4.9.2/bin", "--with-proj-lib=/home/nikhail1/bin/proj-4.9,2/lib", "--with-gdal-config=home/nikhail1/bin/gdal/bin"))

#install.packages('sf',configure.args='--with-gdal-config=/sw/gdal/2.2.3-gcc4/bin/gdal-config --with-proj-include=/sw/proj/4.9.3-gcc4/include --with-proj-lib=/sw/proj/4.9.3-gcc4/lib --with-proj-share=/sw/proj/4.9.3-gcc4/share/proj')
```

## xml包安装
```
 http://xmlsoft.org/downloads.html
 ==>
 http://xmlsoft.org/sources/
```
报错

```
/usr/bin/install: cannot create regular file ‘/usr/lib/python2.7/site-packages/libxml2.py’: Permission denied
```
于是
```
./configure --prefix=`pwd` --with-python=/public/frasergen/MED/software/zhangbo/
miniconda3/envs/xiucz/
```
```
Sys.setenv(XML_CONFIG="/public/frasergen/MED/software/R/R_dependency/libxml2-2.9.1/bin/xml2-config")
```

http://blog.sciencenet.cn/blog-773206-1155793.html